# /etc/resolv
#adds the proper resolv.conf files.
#Jan 9, 2005 | Initial Config | Luis E . Cerezo
control:
	actionsequence = ( resolve editfiles )
	etc_hosts = ( ExecResult(/bin/grep 127.0.0.1 /etc/hosts) )
	nslookup = (ExecShellResult(/usr/bin/host ${host} |cut -d ${quote} ${quote} -f 4) )
        short_name = ( ExecShellResult(/bin/hostname | cut -d . -f1) )
	!externalClients::
		EmptyResolvConf = ( true )
groups:
	likewisePOC = ( FileExists(/usr/likewise) )
	badhosts = ( RegCmp("^.*127\.0\.0\.1.*onshore.pgs.com.*$","${etc_hosts}") )
	baddomain = ( RegCmp("^.*unknown.*$","${domain}") )   
	badip = ( Strcmp("127.0.0.1","${ipaddress}") )
	bad_lookup = ( RegCmp("^.*found.*$", "${nslookup}") )
	not_in_dns_eth0 = ( !Strcmp("${global.ipv4[eth0]}","${nslookup}").net_iface_eth0 )
	not_in_dns_eth1 = ( !Strcmp("${global.ipv4[eth1]}","${nslookup}").net_iface_eth1 )
	not_in_dns_bond0 = ( !Strcmp("${global.ipv4[bond0]}","${nslookup}").net_iface_bond0 )
		

resolve:


	!houdmz.HOU.linux::
						10.20.16.190
						10.20.16.117
						"search onshore.pgs.com hou.compute.pgs.com" 

	houdmz::			192.168.250.12
	
	!heights.LON::		               	10.21.16.29
                                               	10.21.16.28
                                               	10.30.16.16
						"search lon.compute.pgs.com london.pgs.com onshore.pgs.com" 

	KUL::	               	
                                               	10.26.16.12
                                               	172.28.1.15	
						"search onshore.pgs.com cyb.compute.pgs.com kua.pgs.com"
	PER::
						157.147.224.37
						10.27.16.21
						"search perth.pgs.com onshore.pgs.com"
	HOU|lwe.10_20_12|172_16_17|NULL::
						10.20.16.117
						10.20.16.190
						"search onshore.pgs.com hou.compute.pgs.com" 
	RIO::

						10.24.16.39
						172.24.1.1
						172.24.1.2
						"search onshore.pgs.com rio.compute.pgs.com rio.pgs.com"
	heights::

						10.21.16.29
						10.21.16.28
						"search onshore.pgs.com lon.compute.pgs.com"

	ABZ::

						172.16.9.200
						10.21.16.29
						10.21.16.28
						"search onshore.pgs.com lon.compute.pgs.com"
	OSL::
       #                                         10.30.16.16
                                                10.30.16.57
                                                10.21.16.28
	osloDP::
						192.168.2.240
                                                10.30.16.116
                                                10.30.16.57
                                                10.21.16.28
                                                "search oslo.pgs.com whale.pps onshore.pgs.com"

	AUS::
						172.16.6.13
                                                10.20.16.117
                                                10.20.16.190
                                                "search onshore.pgs.com"
	SIN::
                                                10.27.16.21
                                                10.27.16.17
                                                "search onshore.pgs.com"
	CAI::
                                                10.22.16.18
						10.22.16.21
                                                "search onshore.pgs.com cai.compute.pgs.com cair.pgs.com"

editfiles:

        HOU.AllLinuxWorkstations.!baddomain.!badip.!bad_lookup::

        { /etc/hosts
        AppendIfNoSuchLine "${ipaddress}${tab}${fqhost} ${host}"
        }

	!servers.(badip|badhosts).!baddomain.!bad_lookup::

	{ /etc/hosts
	EmptyEntireFilePlease
	AppendIfNoSuchLine "127.0.0.1 ${tab} localhost.localdomain localhost"
	AppendIfNoSuchLine "::1 localhost.localdomain localhost"
	AppendIfNoSuchLine "${nslookup}${tab}${fqhost} ${host}"
	}

        !servers.!baddomain.not_in_dns_eth0.!not_in_dns_eth1.!not_in_dns_bond0::
        { /etc/hosts
        EmptyEntireFilePlease
	AppendIfNoSuchLine "# CFEngine manages this file"
        AppendIfNoSuchLine "127.0.0.1 ${tab} localhost.localdomain localhost"
	AppendIfNoSuchLine "::1 localhost.localdomain localhost"
        AppendIfNoSuchLine "${global.ipv4[eth0]}${tab}${short_name}.${domain} ${short_name}"
        }

       !servers.!baddomain.not_in_dns_eth1.!not_in_dns_eth0.!not_in_dns_bond0::
        { /etc/hosts
        EmptyEntireFilePlease
	AppendIfNoSuchLine "# CFEngine manages this file"
        AppendIfNoSuchLine "127.0.0.1 ${tab} localhost.localdomain localhost"
	AppendIfNoSuchLine "::1 localhost.localdomain localhost"
        AppendIfNoSuchLine "${global.ipv4[eth1]}${tab}${short_name}.${domain} ${short_name}"
        }

        !servers.!baddomain.not_in_dns_bond0.!not_in_dns_eth0.!not_in_dns_eth1::
        { /etc/hosts
        EmptyEntireFilePlease
	AppendIfNoSuchLine "# CFEngine manages this file"
        AppendIfNoSuchLine "127.0.0.1 ${tab} localhost.localdomain localhost"
	AppendIfNoSuchLine "::1 localhost.localdomain localhost"
        AppendIfNoSuchLine "${global.ipv4[bond0]}${tab}${short_name}.${domain} ${short_name}"
        }
	HOU.servers::
		{
			/etc/hosts
			AutoCreate
			Backup "false"
			EmptyEntireFilePlease
			IfElapsed 59
			AppendIfNoSuchLine "# CFEngine manages this file"
			AppendIfNoSuchLine "::1 localhost.localdomain localhost"
			AppendIfNoSuchLine "127.0.0.1 localhost.localdomain localhost"
			AppendIfNoSuchLine "10.20.64.121            houbu21 houbu21.onshore.pgs.com"
			AppendIfNoSuchLine "10.20.24.83             pinky pinky.onshore.pgs.com"
			AppendIfNoSuchLine "172.24.4.20             riosgd01 riosgd01.rio.pgs.com"
			AppendIfNoSuchLine "172.24.4.41             riosgd02 riosgd02.rio.pgs.com"
		}
#	because the Microsoft "load balancer" is seriously broken.
	skip_SP_NLB::
		{
			/etc/hosts
			AutoCreate
			Backup "false"
			EmptyEntireFilePlease
			IfElapsed 59
			AppendIfNoSuchLine "# CFEngine manages this file"
			AppendIfNoSuchLine "::1 localhost.localdomain localhost"
			AppendIfNoSuchLine "127.0.0.1 localhost.localdomain localhost"
			AppendIfNoSuchLine "10.20.24.83             pinky pinky.onshore.pgs.com"
			AppendIfNoSuchLine "10.20.16.90		    sponline sponline.onshore.pgs.com spapps spapps.onshore.pgs.com spworkspaces spworkspaces.onshore.pgs.com online.pgs.com online spmysites spmysites.onshore.pgs.com"
		}
#	linux::
#	{ /tmp/outputs
#	AutoCreate
#	AppendIfNoSuchLine "${global.ipv4[eth0]}${tab}${host}.${domain} ${host}"
#       AppendIfNoSuchLine "${global.ipv4[eth1]}${tab}${host}.${domain} ${host}"
#       AppendIfNoSuchLine "${global.ipv4[bond0]}${tab}${host}.${domain} ${host}"
#	AppendIfNoSuchLine "${nslookup}"
#	}
